# AS 관리

## 1. 화면 개요

### 1.1 기본 정보

- **화면명**: AS 관리
- **목적**: AS 목록 조회/검색, AS 상세 확인, AS 처리 기록 관리
- **AS 생성**: 입고 메뉴에서 현장 회수 시 AS 체크하면 자동 생성 (AS 관리 화면에서 직접 등록 불가)

---

## 2. 초기 로드

### 2.1 초기 데이터 로드

- 전체 AS 목록 조회
- 최신순 정렬
- 페이징: 50건씩

### 2.2 초기 화면 상태

- 상태 필터: "상태 전체" 선택
- 검색어: 비어있음
- 요약 영역: 상태별 건수 및 평균 처리 시간 표시

---

## 3. 검색/필터 영역

### 3.1 상태 필터

**필터 옵션:**

- 상태 전체 (기본값) / 회수 / 부분 / 출고 대기 / 재출고 완료

**동작:**

- 선택한 상태의 AS만 목록에 표시
- 요약 영역은 필터와 무관하게 전체 통계 표시

---

### 3.2 검색 기능

**검색 대상:**

- 현장명 / 자재명
- 통합 검색 (OR 조건)

**검색 결과:**

- 매칭된 AS만 표시
- 결과 없으면: "검색 결과가 없습니다" 메시지 테이블에 표시

**검색 동작:**

- 필터와 검색어는 AND 조건으로 동작
- 예: 상태="회수" + 검색어="카메라" → 회수 상태이면서 현장명 또는 자재명에 "카메라"가 포함된 AS만 표시

---

### 3.3 초기화 기능

**[초기화] 버튼 클릭 시:**

- 검색 입력 필드 초기화
- 상태 필터 "상태 전체"로 리셋
- 전체 목록 재조회

---

## 4. 요약 영역

### 4.1 통계 표시

```
회수: 11건 | 출고 대기: 5건 | 재출고 완료: 45건 | 평균 처리: 2.3일
```

**항목 설명:**

- **회수**: 현재 AS 창고에 있는 자재 건수 (상태="회수")
- **출고 대기**: 처리 완료되어 재출고 대기 중인 자재 건수 (상태="출고 대기")
- **재출고 완료**: 재출고 완료된 AS 건수 (상태="재출고 완료")
- **평균 처리**: 재출고 완료 건들의 접수일부터 재출고 완료일까지 평균 소요 일수

**특징:**

- 실시간 업데이트 (AS 생성/출고대기 처리/재출고 완료 시)
- 필터/검색과 무관하게 전체 통계 표시

---

## 5. 목록 테이블

### 5.1 컬럼 구조

| 컬럼명 | 표시 내용 | 비고 |
| --- | --- | --- |
| AS 번호 | AS-2024-001 | 굵게 표시 |
| 현장 | 강남 오피스텔 | 현장명 |
| 자재 | IP카메라 2MP | 자재명 |
| 수량 | 5 (잔여 3, 재출고 2) | 부분 처리 시 상세 표시 |
| 접수일 | 2024-01-20 | 회수 입고일 (YYYY-MM-DD) |
| 경과 | 3일 | 접수일부터 현재까지 경과 일수 |
| 상태 | 뱃지 (회수/부분/출고 대기/재출고 완료) | 색상 구분 |
| 작업 | [출고대기 처리] 버튼 | 상태별 표시 |

**수량 컬럼 표시 규칙:**

- **전체 회수 (처리 전)**: `5` (단순 숫자)
- **부분 처리**: `5 (잔여 3, 재출고 2)` (회수 수량 + 잔여/재출고 분할 표시)
- **전체 출고 대기**: `5` (단순 숫자)
- **재출고 완료**: `5` (단순 숫자)
- 회색 작은 글씨로 잔여/재출고 수량 표시

**수량 용어 정의:**

- **회수 수량**: 입고 메뉴에서 현장 회수로 AS 창고에 입고된 총 수량 (변하지 않음)
- **재출고 완료 수량**: 출고대기 처리된 수량 (출고 메뉴에서 재출고 대기 중)
- **잔여 수량**: 아직 출고대기 처리되지 않은 수량 (회수 수량 - 재출고 완료 수량)

**부분 처리 예시:**

원본 AS가 5개일 때 2개를 수리 재출고로 처리하면:

| AS 번호 | 현장 | 자재 | 수량 | 접수일 | 경과 | 상태 | 작업 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| AS-2024-001 | 강남 오피스텔 | IP카메라 2MP | 5 (잔여 3, 재출고 2) | 2024-01-20 | 3일 | 부분 | [출고대기 처리] |

- 하나의 행으로 표시
- 수량: 회수 수량 + 잔여/재출고 분할 표시
- 상태: "부분" (파란색 뱃지)
- 작업: [출고대기 처리] 버튼만 표시
- AS 유형 및 처리 내역은 상세 모달에서 확인

**추가 처리 시:**

3개를 교체 출고로 추가 처리하면:

| AS 번호 | 현장 | 자재 | 수량 | 접수일 | 경과 | 상태 | 작업 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| AS-2024-001 | 강남 오피스텔 | IP카메라 2MP | 5 | 2024-01-20 | 3일 | 출고 대기 | - |

- 모든 수량이 처리되면 상태가 "출고 대기"로 변경
- 수량: 단순 숫자만 표시 (잔여 0)
- 작업 컬럼 빈 칸
- AS 유형 및 처리 내역은 상세 모달에서 확인

---

### 5.2 행 클릭

**트리거:** 테이블 행 클릭

**동작:**

- 해당 AS의 상세 모달 오픈
- AS 상세 정보 및 타임라인 로드

**예외:**

- "작업" 컬럼의 버튼 클릭 시에는 행 클릭 무시
- 버튼만 동작

---

### 5.3 경과 시간 표시

**표시 방식:**

- 접수일(회수 입고일)부터 현재까지 경과 일수
- 형식: "N일"

**계산 규칙:**

- 당일: "0일"
- 1일 경과: "1일"
- 실시간 자동 계산

---

### 5.4 상태 뱃지

**상태별 표시:**

| 상태 | 텍스트 | 색상 | 설명 |
| --- | --- | --- | --- |
| 회수 | 회수 | 파란색 (status-approved) | AS 창고 입고, 처리 대기 중 (전체 수량) |
| 부분 | 부분 | 청록색 (info) | 일부 수량만 처리됨 (회수 + 출고대기 혼재) |
| 출고 대기 | 출고 대기 | 주황색 (status-pending) | 처리 완료, 재출고 대기 중 (전체 수량) |
| 재출고 완료 | 재출고 완료 | 회색 (status-ok) | 재출고 완료, AS 종결 |

**상태 결정 로직:**

- 잔여 수량 = 회수 수량, 재출고 완료 수량 = 0 → "회수"
- 잔여 수량 > 0, 재출고 완료 수량 > 0 → "부분"
- 잔여 수량 = 0, 재출고 완료 수량 = 회수 수량 → "출고 대기"
- 출고 메뉴에서 재출고 완료 → "재출고 완료"

---

### 5.5 [출고대기 처리] 버튼 및 작업 컬럼

**표시 조건:**

- 상태가 "회수" 또는 "부분"인 경우: [출고대기 처리] 버튼 표시
- 상태가 "출고 대기"인 경우: AS 유형 및 수량 표시 (버튼 없음)
- 상태가 "재출고 완료"인 경우: 빈 칸

**작업 컬럼 표시 내용:**

| 상태 | 표시 내용 | 비고 |
| --- | --- | --- |
| 회수 | [출고대기 처리] 버튼 | 전체 수량 처리 가능 |
| 부분 | [출고대기 처리] 버튼 | 잔여 수량 처리 가능 |
| 출고 대기 | 빈 칸 | - |
| 재출고 완료 | 빈 칸 | - |

**클릭 동작:**

- 출고대기 처리 모달 오픈
- 행 클릭 이벤트 차단 (event.stopPropagation())
- 현재 AS 정보 표시 (AS 번호, 현장, 자재, 총 수량, 잔여 회수 수량)

**참고:**

- AS 유형 및 처리 내역은 상세 모달에서 확인 가능

---

## 6. AS 상세 모달

### 6.1 오픈 조건

- 테이블 행 클릭

---

### 6.2 표시 정보

**기본 정보 영역 (info-box):**

| 항목 | 표시 내용 | 비고 |
| --- | --- | --- |
| AS 번호 | AS-2024-001 | 굵게 표시 |
| 상태 | 회수 / 부분 / 출고 대기 / 재출고 완료 | 뱃지 형태 |
| 현장 | 강남 오피스텔 (SITE-2024-001) | 현장명 + 현장코드 |
| 자재 | IP카메라 2MP (CAM-001) | 자재명 + 자재코드 |
| 회수 수량 | 5개 | 입고 시 회수한 총 수량 (고정) |
| 재출고 완료 수량 | 2개 | 출고대기 처리된 수량 |
| 잔여 수량 | 3개 | 아직 처리되지 않은 수량 (강조 표시) |
| 시리얼 | CAM-2024-015, CAM-2024-016 | 시리얼 번호 (복수 가능) |
| 접수일 | 2024-01-20 10:00 | YYYY-MM-DD HH:mm |
| 경과 시간 | 3일 2시간 | 주황색 강조 |

**수량 표시 규칙:**

- **회수 상태**: 회수 수량만 표시 (재출고 완료 수량, 잔여 수량 숨김)
- **부분 상태**: 회수 수량, 재출고 완료 수량, 잔여 수량 모두 표시
- **출고 대기 상태**: 회수 수량, 재출고 완료 수량만 표시 (잔여 수량 0이므로 숨김)
- **재출고 완료 상태**: 회수 수량만 표시

**AS 처리 내역 영역:**

- 제목: "AS 처리 내역"
- 부분 처리 또는 출고 대기 상태일 때 표시
- AS 유형별 처리 수량 표시
  - 예: 수리 재출고 2개, 교체 출고 3개
- 회수 상태일 때는 표시 안 함

**처리 진행 상황 (타임라인):**

- 제목: "처리 진행 상황"
- 타임라인 형태로 AS 처리 이력 표시
- 시간 역순 정렬 (최신이 위)

---

### 6.3 타임라인 구조

**타임라인 아이템 구성:**

- **시간**: YYYY-MM-DD HH:mm
- **내용**: 처리 내용 제목 (굵게) + 담당자명
- **메모**: 상세 내용 (회색 텍스트)

**타임라인 예시:**

```
2024-01-20 10:00
회수 완료 - 김창고
AS 창고 입고 (입고번호: IN-2024-050)

2024-01-21 14:00
수리 재출고 - 김수리
메인보드 교체 완료. 정상 작동 확인.

예정
재출고 대기
```

**타임라인 상태:**

- 완료된 기록: 일반 표시
- 예정 기록: pending 클래스, 회색 텍스트

---

### 6.4 [닫기] 버튼

**동작:**

- 모달 닫기
- 목록 화면으로 복귀

---

## 7. 출고대기 처리 모달

### 7.1 모달 오픈

**트리거:**

- 목록의 [출고대기 처리] 버튼 클릭

**표시 정보:**

- 모달 제목: "출고대기 처리 - AS-2024-001"
- 현재 AS 정보 (읽기 전용)
  - 현재 상태: 회수 (뱃지)
  - 자재: IP카메라 2MP
  - 현장: 강남 오피스텔
  - 총 수량: 2개

---

### 7.2 입력 필드

**필수 입력 (*):**

- **처리 수량*** (number input)
  - 출고대기 처리할 수량 입력
  - 최소값: 1
  - 최대값: 총 수량
  - 기본값: 총 수량
  - placeholder: "처리할 수량"

- **AS 유형*** (라디오 버튼)
  - 수리 재출고 (기본 선택)
  - 교체 출고
  - 단일 선택

- **처리 내용*** (textarea)
  - 수리/처리 내용 상세 입력
  - placeholder: "수리/처리 내용을 입력하세요"
  - rows: 4

**자동 입력:**

- **담당자**: 로그인한 사용자 정보로 자동 입력 (화면에 표시 안 함)

---

### 7.3 [출고대기 처리] 버튼

**유효성 검증:**

1. 처리 수량 입력 확인
   - 미입력 또는 0 이하: "처리 수량을 입력해주세요" 알림
2. 처리 수량 범위 확인
   - 총 수량 초과 시: "처리 수량은 총 수량(N개)을 초과할 수 없습니다" 알림
3. AS 유형 선택 확인
   - 미선택 시: "AS 유형을 선택해주세요" 알림 (기본 선택되어 있으므로 발생 안 함)
4. 처리 내용 입력 확인
   - 미입력 시: "처리 내용을 입력해주세요" 알림

**동작 순서:**

1. 필수 필드 검증
2. 처리 수량 검증
3. AS 처리 기록 추가 (내부 데이터)
   - 처리 수량, AS 유형, 처리 내용 저장
   - 여러 번 처리 가능 (부분 처리)
4. AS 상태 업데이트
   - 회수 수량 감소 (총 수량 - 처리 수량)
   - 출고대기 수량 증가 (+ 처리 수량)
   - 상태 자동 결정:
     - 회수 수량 > 0, 출고대기 수량 > 0 → "부분"
     - 회수 수량 = 0, 출고대기 수량 = 총 수량 → "출고 대기"
5. 타임라인에 처리 기록 추가
   - 시간: 현재 시각
   - 담당자: 로그인 사용자 (자동)
   - 내용: AS 유형 + 처리 내용 + 수량
   - 예: "수리 재출고 (2개) - 메인보드 교체 완료"
6. 성공 알림: "출고대기 처리가 완료되었습니다"
7. 모달 닫기
8. 목록 갱신

**부분 처리 로직:**

- **처리 수량 < 회수 수량 (부분 처리)**: 
  - 하나의 AS 건 내에서 수량 분할 관리
  - 재출고 완료 수량: 기존 재출고 완료 수량 + 처리 수량
  - 잔여 수량: 회수 수량 - 재출고 완료 수량
  - 상태: "부분"
  - AS 유형 및 수량 기록 (여러 번 처리 가능)
  - 잔여 수량에 대해 계속 처리 가능
  
  **예시:**
  ```
  초기: AS-2024-001 (회수 5개, 재출고 0개, 잔여 5개, 상태: 회수)
    ↓ 2개 수리 재출고 처리
  결과: AS-2024-001 (회수 5개, 재출고 2개, 잔여 3개, 상태: 부분)
    ↓ 3개 교체 출고 처리
  결과: AS-2024-001 (회수 5개, 재출고 5개, 잔여 0개, 상태: 출고 대기)
  ```
  
- **처리 수량 = 회수 수량 (전체 처리)**:
  - 재출고 완료 수량: 회수 수량
  - 잔여 수량: 0
  - 상태: "출고 대기"
  - AS 유형 기록

**목록 화면 표시:**
- 하나의 행으로 표시
- 수량 컬럼: 회수 수량 + 잔여/재출고 분할 표시 (부분 처리 시)
- 상태 컬럼: 회수/부분/출고 대기/재출고 완료
- 작업 컬럼: 
  - 회수/부분 상태: [출고대기 처리] 버튼만 표시
  - 출고 대기/재출고 완료 상태: 빈 칸
- AS 유형 및 처리 내역은 상세 모달의 "AS 처리 내역" 영역에서 확인

**주의사항:**

- 출고대기 처리 시 AS 상태가 자동으로 결정됨 (회수 → 부분 → 출고 대기)
- 부분 처리 시 잔여 수량에 대해 여러 번 처리 가능
- 각 처리 기록은 타임라인에 누적 기록됨
- 출고 메뉴에서 재출고 시 재출고 완료 수량만큼 출고 가능

---

### 7.4 [취소] 버튼

**동작:**

- 모달 닫기
- 입력 내용 저장 안 함

---

## 8. AS 자동 생성 (입고 메뉴 연동)

### 8.1 생성 조건

- 입고 유형: "현장 회수"
- 자재별 "AS 입고 여부" 체크
- 입고 등록 완료 시 AS 자동 생성

**중요:**

- AS는 입고 메뉴에서만 생성됨
- AS 관리 화면에서 직접 등록 불가

---

### 8.2 자동 생성 데이터

**AS 기본 정보:**

- **AS 번호**: AS-YYYY-NNN (백엔드 자동 생성)
  - 형식: AS + - + 연도(4자리) + - + 일련번호(3자리)
  - 예: AS-2024-001
  - 연도별 순번 관리
- **상태**: "회수" (초기 상태 고정)
- **현장**: 입고 시 선택한 현장
- **발주**: 입고 시 선택한 발주 (있는 경우)
- **자재**: 입고 자재 정보 (자재코드, 자재명)
- **시리얼**: 입고 시 입력한 시리얼 번호
- **접수일**: 입고일시
- **문제 유형**: 회수 사유 매핑
  - 고장 → 고장
  - 파손 → 파손
  - 미사용 → 기타
  - 과다출고 → 기타
  - 오작동 → 오작동

---

### 8.3 타임라인 자동 기록

**첫 번째 타임라인 기록 (회수 완료):**

- **시간**: 입고일시
- **담당자**: 입고 담당자
- **내용**: "현장 회수 완료"
- **메모**: 
  ```
  AS 창고 입고 (입고번호: IN-2024-XXX)
  문제 유형: [문제 유형]
  회수 사유: [회수 사유]
  ```

**예시:**

```
2024-01-20 10:00
현장 회수 완료 - 김창고
AS 창고 입고 (입고번호: IN-2024-050)
문제 유형: 초기 불량
회수 사유: 영상이 나오지 않음. 전원은 들어오나 화면 출력 안 됨.
```

---

### 8.4 재고 연동

**AS 회수 시 재고 처리:**

- 가용 재고 증가 (일반 입고와 동일)
- AS 전용 재고로 별도 관리하지 않음
- 시리얼 상태: "AS 중" 또는 일반 재고 상태 유지 (정책 미정)

**재출고 시 재고 처리:**

- 가용 재고 감소 (일반 출고와 동일)

---

## 9. AS 재출고 완료 (출고 메뉴 연동)

### 9.1 출고 메뉴 AS 자재 노출

**노출 조건:**

- 상태가 "회수" 또는 "출고 대기"인 AS 자재만 표시
- 상태가 "재출고 완료"인 AS는 표시 안 함

**표시 정보:**

- AS 번호
- 자재명
- 현재 상태 (회수 / 출고 대기)
- 현장명

**예시:**

```
IP카메라 2MP (AS-2024-001) - 출고 대기
NVR 16채널 (AS-2024-002) - 회수
```

---

### 9.2 재출고 시 상태 체크

**출고 대기 상태:**

- 정상 재출고 진행
- 별도 경고 없음

**회수 상태:**

- 경고 메시지 표시
  - "이 AS는 아직 출고 대기 처리되지 않았습니다. 계속하시겠습니까?"
- 확인 시: 재출고 진행 가능
- 취소 시: 재출고 취소

---

### 9.3 자동 상태 변경

**트리거:**

- 출고 메뉴에서 AS 재출고 완료 시

**동작:**

- AS 상태: "회수" 또는 "출고 대기" → "재출고 완료" 자동 변경
- 재출고 완료일시: 출고일시

---

### 9.4 타임라인 자동 기록

**재출고 완료 타임라인 추가:**

- **시간**: 출고일시
- **담당자**: 출고 담당자
- **내용**: "재출고 완료"
- **메모**: "출고번호: OUT-2024-XXX"

**예시:**

```
2024-01-23 14:00
재출고 완료 - 이출고
출고번호: OUT-2024-051
```

---

### 9.5 재고 연동

- 가용 재고 감소 (일반 출고와 동일)
- 시리얼 상태: 출고 상태로 변경

---

## 10. 상태 정의 및 흐름

### 10.1 상태 종류

| 상태 코드 | 한글명 | 설명 | 상태 변경 주체 |
| --- | --- | --- | --- |
| received | 회수 | AS 창고 입고, 수리/처리 대기 중 | 입고 메뉴 (자동) |
| ready | 출고 대기 | 처리 완료, 재출고 대기 중 | AS 관리 화면 (출고대기 처리) |
| completed | 재출고 완료 | 재출고 완료, AS 종결 | 출고 메뉴 (자동) |

---

### 10.2 상태 흐름

**기본 흐름:**

```
[입고 메뉴] → 회수 → [출고대기 처리] → 출고 대기 → [출고 메뉴] → 재출고 완료
```

**상세 흐름:**

```
입고 메뉴에서 현장 회수 + AS 체크
    ↓
AS 자동 생성 (상태: 회수)
    ↓
타임라인 자동 기록 (회수 완료)
    ↓
AS 관리 화면에서 출고대기 처리
    ↓
AS 유형 선택 (수리 재출고 / 교체 출고)
    ↓
처리 내용 입력
    ↓
상태 변경: 회수 → 출고 대기
    ↓
타임라인 기록 추가 (AS 유형 + 처리 내용)
    ↓
출고 메뉴에서 AS 재출고 처리
    ↓
상태 체크 (회수 상태면 경고)
    ↓
AS 상태 자동 변경 (재출고 완료)
    ↓
타임라인 자동 기록 (재출고 완료)
```

**상태 변경 규칙:**

- 회수 → 출고 대기: AS 관리 화면에서 수동 처리
- 출고 대기 → 재출고 완료: 출고 메뉴에서 자동 처리
- 회수 → 재출고 완료: 출고 메뉴에서 가능 (경고 표시)

---

### 10.3 상태별 의미

**회수 (received):**

- AS 창고에 입고된 상태
- 수리/처리 대기 중
- 출고대기 처리 가능
- 긴급 재출고 가능 (경고 표시)

**출고 대기 (ready):**

- 처리 완료된 상태
- 재출고 대기 중
- 정상 재출고 가능

**재출고 완료 (completed):**

- 현장으로 재출고 완료
- AS 처리 종결
- 더 이상 처리 불가

---

## 11. 타임라인 기록

### 11.1 기록 유형

**1. 회수 완료 (AS 자동 생성 시)**

- **생성 시점**: 입고 메뉴에서 AS 자동 생성 시
- **담당자**: 입고 담당자
- **내용**: "현장 회수 완료"
- **메모**: 
  ```
  AS 창고 입고 (입고번호: IN-2024-XXX)
  ```

---

**2. 출고대기 처리 (출고대기 처리 모달)**

- **생성 시점**: AS 관리 화면에서 출고대기 처리 시
- **담당자**: 로그인 사용자 (자동)
- **내용**: AS 유형 + 처리 내용
  - 예: "수리 재출고 - 메인보드 교체 완료"
  - 예: "교체 출고 - 신품으로 교체"
- **특징**: 한 번만 추가 가능 (상태 변경됨)

**예시:**

```
2024-01-21 14:00
수리 재출고 - 김수리
메인보드 불량으로 메인보드 교체 완료. 정상 작동 확인.
```

---

**3. 재출고 완료 (출고 메뉴 자동)**

- **생성 시점**: 출고 메뉴에서 AS 재출고 완료 시
- **담당자**: 출고 담당자
- **내용**: "재출고 완료"
- **메모**: "출고번호: OUT-2024-XXX"

---

### 11.2 타임라인 정렬

- 시간 역순 정렬 (최신이 위)
- 상세 모달에서 전체 이력 표시

---

### 11.3 타임라인 표시 형식

**완료된 기록:**

```
[시간]
[내용] - [담당자]
[메모]
```

**예정 기록 (재출고 완료 전):**

```
예정
재출고 대기
```

- pending 클래스 적용
- 회색 텍스트 표시

---

## 12. AS 삭제/취소

### 12.1 삭제 가능 조건

**삭제 가능:**

- 상태가 "회수"인 경우
- 잘못 생성된 AS 건 삭제

**삭제 불가:**

- 상태가 "출고 대기" 또는 "재출고 완료"인 경우
- 이미 처리되었거나 완료된 AS는 이력 보존을 위해 삭제 불가

---

### 12.2 삭제 기능

**트리거:**

- AS 상세 모달에서 [삭제] 버튼 클릭 (회수 상태만 표시)
- 또는 목록에서 삭제 버튼 (추가 구현 시)

**동작 순서:**

1. 삭제 확인 메시지 표시
   - "이 AS 건을 삭제하시겠습니까?"
   - "삭제된 AS는 복구할 수 없습니다."
2. 확인 시: AS 삭제 처리
3. 성공 알림: "AS가 삭제되었습니다"
4. 모달 닫기
5. 목록 갱신 (해당 행 제거)

---

### 12.3 삭제 시 연관 데이터 처리

**재고:**

- AS 회수로 증가한 재고는 유지
- 재고 조정 불필요 (이미 입고 처리됨)

**입고 이력:**

- 입고 이력은 유지
- AS 연결만 해제

**타임라인:**

- AS 삭제 시 타임라인도 함께 삭제

**출고 대기 상태 삭제 시:**

- 출고 대기 상태는 삭제 불가
- "출고 대기 상태의 AS는 삭제할 수 없습니다" 알림

---

## 13. 유효성 검증 규칙

### 13.1 출고대기 처리 필수 필드

**필수 입력:**

- AS 유형 (라디오 버튼, 기본 선택됨)
- 처리 내용

**검증 방식:**

- 처리 내용 미입력 시: "처리 내용을 입력해주세요" 알림
- 해당 필드로 포커스 이동

---

### 13.2 검색어 검증

**검증 규칙:**

- 최소 1자 이상 입력
- 특수문자 허용
- 공백만 입력 시: 검증 오류

---

### 13.3 삭제 검증

**검증 규칙:**

- 상태가 "회수"인 경우만 삭제 가능
- 출고 대기 상태: "출고 대기 상태의 AS는 삭제할 수 없습니다" 알림
- 재출고 완료 상태: "재출고 완료된 AS는 삭제할 수 없습니다" 알림

---

## 14. 에러 처리

### 14.1 사용자 입력 오류

| 상황 | 메시지 | 동작 |
| --- | --- | --- |
| 필수 필드 누락 | "필수 항목을 모두 입력해주세요." | 해당 필드 포커스 |
| 삭제 불가 상태 | "재출고 완료된 AS는 삭제할 수 없습니다." | 알림만 표시 |
| 검색 결과 없음 | "검색 결과가 없습니다." | 테이블에 메시지 표시 |

---

### 14.2 시스템 오류

| 상황 | 메시지 | 동작 |
| --- | --- | --- |
| 목록 조회 실패 | "AS 목록을 불러오는데 실패했습니다." | 재시도 버튼 표시 |
| 상세 조회 실패 | "AS 상세 정보를 불러오는데 실패했습니다." | 모달 닫기 |
| 처리 기록 추가 실패 | "처리 기록 추가에 실패했습니다." | 재시도 안내 |
| 삭제 실패 | "AS 삭제에 실패했습니다." | 재시도 안내 |

---

## 15. 비즈니스 규칙

### 15.1 AS 번호 생성

- 자동 생성 (수동 입력 불가)
- 형식: AS + - + YYYY + - + NNN
- 예: AS-2024-001 (2024년, 첫 번째)
- 연도별 순번 관리
- 백엔드에서 자동 생성 (입고 메뉴에서)

---

### 15.2 경과 시간 계산

**목록 화면:**

```
경과 시간 = 현재 날짜 - 접수일
표시 형식: "N일"
```

**상세 화면:**

```
경과 시간 = 현재 시각 - 접수일시
표시 형식: "N일 N시간"
```

**자동 계산:**

- 실시간 자동 계산
- 페이지 로드 시마다 갱신

---

### 15.3 평균 처리 시간 계산

```
평균 처리 시간 = Σ(재출고 완료일 - 접수일) / 재출고 완료 건수
표시 형식: "N.N일"
```

**계산 대상:**

- 상태가 "재출고 완료"인 AS만 포함
- 소수점 첫째 자리까지 표시

---

### 15.4 처리 기록 규칙

- 회수 상태에서만 추가 가능
- 여러 번 추가 가능 (횟수 제한 없음)
- 추가 시 상태 변경 없음
- 타임라인에 즉시 반영

---

### 15.5 재고 연동 규칙

**AS 회수 시 (입고 메뉴):**

- 가용 재고 증가
- 일반 재고와 동일하게 관리
- AS 전용 재고 구분 없음

**AS 재출고 시 (출고 메뉴):**

- 가용 재고 감소
- 일반 출고와 동일하게 처리

---

### 15.6 시리얼 추적 규칙

**AS 회수 시:**

- 시리얼 상태: "AS 중" 또는 일반 상태 유지 (정책 미정)
- 시리얼 이동 이력 기록

**AS 재출고 시:**

- 시리얼 상태: "출고" 상태로 변경
- 시리얼 이동 이력 기록

---

## 16. 화면 흐름도

### 16.1 AS 생성 흐름 (입고 메뉴)

```
입고 메뉴에서 현장 회수 선택
    ↓
자재별 AS 입고 여부 체크
    ↓
입고 등록 완료
    ↓
AS 자동 생성 (상태: 회수)
    ↓
AS 번호 자동 생성 (AS-YYYY-NNN)
    ↓
타임라인 자동 기록 (회수 완료)
    ↓
가용 재고 증가
    ↓
AS 관리 화면 목록에 표시
```

---

### 16.2 처리 기록 추가 흐름

```
AS 관리 목록에서 [처리 기록] 버튼 클릭
    ↓
처리 기록 모달 오픈
    ↓
현재 AS 정보 표시 (읽기 전용)
    ↓
담당자, 처리 내용, 교체 부품 입력
    ↓
[기록 추가] 클릭
    ↓
필수 필드 검증
    ↓
타임라인에 처리 기록 추가
    ↓
성공 알림
    ↓
모달 닫기
```

---

### 16.3 AS 재출고 완료 흐름 (출고 메뉴)

```
출고 메뉴에서 AS 재출고 선택
    ↓
AS 번호 연결
    ↓
출고 등록 완료
    ↓
AS 상태 자동 변경 (재출고 완료)
    ↓
타임라인 자동 기록 (재출고 완료)
    ↓
가용 재고 감소
    ↓
AS 관리 화면 목록 갱신
```

---

### 16.4 AS 삭제 흐름

```
AS 상세 모달에서 [삭제] 버튼 클릭
    ↓
상태 검증 (회수 상태만 가능)
    ↓
삭제 확인 메시지
    ↓
확인 클릭
    ↓
AS 삭제 처리
    ↓
성공 알림
    ↓
모달 닫기
    ↓
목록 갱신 (해당 행 제거)
```

---

## 17. 개발 체크리스트

### 17.1 필수 구현 사항

- [ ]  AS 목록 조회 (페이징)
- [ ]  검색 (현장명/자재명 통합)
- [ ]  상태 필터
- [ ]  AS 상세 조회 (타임라인 포함)
- [ ]  처리 기록 추가
- [ ]  AS 삭제 (회수 상태만)
- [ ]  입고 메뉴 연동 (AS 자동 생성)
- [ ]  출고 메뉴 연동 (재출고 시 자동 완료)

---

### 17.2 유효성 검증

- [ ]  검색어 입력 검증
- [ ]  필수 필드 검증 (처리 기록)
- [ ]  삭제 가능 상태 검증
- [ ]  경과 시간 자동 계산
- [ ]  평균 처리 시간 자동 계산

---

### 17.3 사용자 경험

- [ ]  검색/필터 즉시 반영
- [ ]  성공/실패 알림 명확히
- [ ]  포커스 관리 (오류 필드로 이동)
- [ ]  로딩 인디케이터 표시
- [ ]  모달 배경 클릭 시 닫기
- [ ]  행 클릭 vs 버튼 클릭 구분

---

### 17.4 비즈니스 로직

- [ ]  AS 번호 자동 생성 (입고 메뉴)
- [ ]  경과 시간 자동 계산
- [ ]  평균 처리 시간 자동 계산
- [ ]  상태별 색상 구분
- [ ]  타임라인 자동 기록
- [ ]  재고 연동 (회수 시 증가, 재출고 시 감소)

---

## 18. 주의사항

### 18.1 반드시 지켜야 할 사항

1. **AS는 입고 메뉴에서만 생성** ⭐⭐⭐
   - AS 관리 화면에서 직접 등록 불가
   - 입고 유형 "현장 회수" + AS 체크 시 자동 생성
2. **상태 변경은 자동으로만 처리**
   - 회수: 입고 메뉴에서 자동 설정
   - 재출고 완료: 출고 메뉴에서 자동 변경
   - AS 관리 화면에서 상태 직접 변경 불가
3. **처리 기록 추가 시 상태 변경 없음**
   - 처리 기록은 타임라인에만 추가
   - 상태는 "회수"로 유지
4. **재출고 완료 후 삭제 불가**
   - 이력 보존을 위해 완료된 AS는 삭제 불가
   - 회수 상태에서만 삭제 가능

---

### 18.2 사용자 경험 개선

1. 검색/필터 결과 즉시 반영
2. 에러 메시지 명확하고 친절하게
3. 필수 필드 표시 명확히 (*)
4. 로딩 상태 표시
5. 성공/실패 알림 일관성 있게
6. 타임라인 시간 역순 정렬 (최신이 위)

---

### 18.3 데이터 일관성

1. AS 번호 중복 방지 (연도별 순번 관리)
2. 경과 시간 실시간 계산
3. 평균 처리 시간 정확성
4. 재고 연동 정확성 (회수/재출고)
5. 타임라인 누락 없이 기록

---

## 19. 참고 사항

### 19.1 향후 개선 사항

- AS 비용 관리 (수리비, 부품비)
- AS 사진 첨부 (수리 전/후)
- AS 통계 대시보드
- AS 알림 기능 (담당자, 현장 관리자)
- AS 처리 기한 설정 및 알림
- AS 처리 이력 Excel 다운로드
- AS 처리 만족도 평가

---

### 19.2 관련 화면

- **입고 관리**: 현장 회수 시 AS 자동 생성
- **출고 관리**: AS 재출고 시 AS 자동 완료
- **재고 관리**: AS 입고/재출고 시 재고 증감
- **현장 통합 현황**: 현장별 AS 현황 조회

---

### 19.3 미정 정책

**시리얼 상태 관리:**

- AS 회수 시 시리얼 상태를 "AS 중"으로 변경할지 여부
- 현재는 일반 재고 상태 유지로 가정
- 추후 정책 결정 필요

**AS 전용 재고:**

- AS 자재를 별도 재고로 관리할지 여부
- 현재는 일반 재고와 통합 관리
- 추후 정책 결정 필요

---
