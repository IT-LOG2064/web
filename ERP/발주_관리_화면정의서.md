# 발주 관리

## 1. 화면 개요

### 1.1 기본 정보

- **화면명**: 발주 관리
- **목적**: 발주 목록 조회/검색, 발주 상세 확인, 신규 발주 등록, 발주 수정

---

## 2. 탭 구성

2개의 탭으로 구성됨:

- **탭 1: 발주 목록** (기본)
- **탭 2: 발주 등록**

---

## 3. 탭 1: 발주 목록

### 3.1 초기 로드

- 전체 발주 목록 조회
- 최신순 정렬

### 3.2 검색/필터 영역

**필터 옵션:**

- 상태 전체 / 출고대기 / 출고완료
- 견적 전체 / 등록된 견적 목록

**검색 대상:**

- 발주번호 / 견적명
- 통합 검색 (OR 조건)

**[초기화] 버튼:** 모든 필터 초기화 후 전체 재조회

### 3.3 요약 영역

```
전체: 28건 | 출고대기: 5건 | 출고완료: 23건
```

**[+ 새 발주 등록] 버튼:**

- 클릭 시 발주 등록 탭으로 전환

### 3.4 목록 테이블

**컬럼 구조:**

| 컬럼명 | 표시 내용 | 비고 |
| --- | --- | --- |
| 발주 번호 | IT260115-01 | 굵게 표시 |
| 본사 | 강남건설 |  |
| 현장 | 강남 오피스텔 |  |
| 견적명 | 강남 오피스텔 CCTV 설치 | 견적변경 뱃지 표시 가능 |
| 발주일 | 2024-01-15 |  |
| 자재 수 | 5종 |  |
| 총 수량 | 120개 |  |
| 상태 | 뱃지 (출고대기/출고완료) | 색상 구분 |
| 작업 | (비어있음, 추후 추가) |  |

**행 클릭:** 발주 상세 모달 오픈

**견적변경 뱃지:** 발주 이후 연결된 견적이 수정된 경우 표시 (주황색)

### 3.5 상태 뱃지

| 상태 | 색상 |
| --- | --- |
| 출고대기 | 주황색 |
| 출고완료 | 초록색 |

---

## 4. 탭 2: 발주 등록

### 4.1 화면 구성

2단 레이아웃:
- 왼쪽: 현장/견적 선택 영역
- 오른쪽: 발주 자재 편집 영역

### 4.2 현장/견적 선택 영역

**검색:**

- 현장명/견적명 검색 입력

**현장 선택* (필수):**

- 드롭다운, 등록된 현장 목록

**견적 선택* (필수):**

- 드롭다운, 선택한 현장의 수주 견적 목록

**최근 수주 건:**

- [최근 수주 건 보기] 버튼 → 최근 수주 견적 선택 모달 오픈

**견적서 보기/다운로드:**

- [견적서 보기] / [견적서 다운로드] 버튼

### 4.3 발주 자재 편집 영역

**견적 자재 목록 (왼쪽 패널):**

- 선택한 견적의 자재 목록 표시
- 컬럼: 자재코드, 자재명, 규격, 수량, 단위

**발주 자재 목록 (오른쪽 패널):**

- 실제 발주할 자재 목록
- 드래그 앤 드롭으로 순서 변경 가능
- 컬럼: ⋮⋮(드래그), 자재명/규격, 수량(편집), 단위, 품질(신품/중고), 삭제
- 동일 자재 중복 추가 가능 (각 행은 독립적으로 관리)

**[세트 불러오기] 버튼:**

- 자재 세트 선택 모달 오픈, 세트 자재를 발주 목록에 추가
- 세트 데이터는 자재정보 메뉴의 자재 세트 관리에서 관리

### 4.4 비고

- 텍스트 영역

### 4.5 하단 버튼

- [초기화]: 발주 등록 폼 초기화
- [임시저장]: 현재 입력 내용 임시 저장
- [등록]: 발주 등록 처리

### 4.6 탭 이탈 처리

**작성 중 다른 탭 클릭 시:**

- "작성 중입니다." 확인 모달 표시
- [임시저장] / [그냥 나가기] / [취소] 버튼 제공

---

## 5. 발주 상세 모달

### 5.1 오픈 조건

- 발주 목록 행 클릭

### 5.2 표시 정보

**기본 정보:**

- 발주 번호
- 견적 (연결된 견적명)
- 본사 / 현장
- 발주일
- 상태

**발주 자재 목록:**

| 컬럼 | 내용 |
| --- | --- |
| 자재명 | IP카메라 2MP |
| 수량 | 50개 |
| 단위 | 개 |

**출고 현황:**

- 발주 대비 출고 현황 테이블

### 5.3 버튼

- [수정]: 발주 수정 모달 오픈
- [닫기]: 모달 닫기

---

## 6. 발주 수정 모달

### 6.1 오픈 조건

- 발주 상세 모달의 [수정] 버튼 클릭

### 6.2 특징

- 전체화면(⛶) 토글 버튼 제공
- 발주 번호 표시 (변경 불가)
- 발주 수정 시 견적 변경 불가 (발주 등록 시 선택한 견적으로 고정)
- 발주 자재 목록 편집 (드래그 앤 드롭 순서 변경, 수량/품질 편집, 삭제)
- 자재 추가 방법:
  - 자재 검색 자동완성 기능 (입력 필드에서 직접 검색)
  - [자재검색] 버튼: 자재 마스터 검색 모달 오픈 (다중 선택 가능)
  - [세트 선택] 버튼: 자재 세트 선택 모달 오픈
- 수정 사유 필수 입력 (수정 이력에 자동 기록)

### 6.3 버튼

- [저장]: 수정 처리
- [닫기]: 모달 닫기

---

## 7. 비즈니스 규칙

### 7.1 발주 번호 생성

- 자동 생성
- 형식: IT + YYMMDD + - + 일련번호
- 예: IT260115-01 (2026년 1월 15일, 첫 번째)

### 7.2 견적 연동

- 발주는 반드시 수주 상태의 견적과 연결
- 발주 수정 시 견적 변경 불가 (발주와 견적의 연결 관계 고정)
- 견적 수정 시 연결된 발주에 "견적변경" 뱃지 표시 (백엔드에서 자동 처리)

### 7.3 출고 상태

- 발주 자재의 출고가 완료되면 "출고완료" 상태로 변경
- 부분 출고 시 "출고대기" 상태 유지
- 출고 완료 판단: 발주 수량 대비 출고 수량이 100% 일치 시 (백엔드에서 자동 처리)

---

## 8. 유효성 검증

### 8.1 발주 등록 필수 필드

- 현장
- 견적
- 발주 자재 (최소 1개)

### 8.2 자재 수량

- 1 이상 숫자만 입력 가능
- 동일 자재 중복 추가 가능 (각 행은 독립적으로 관리)

---

## 9. 에러 처리

| 상황 | 메시지 |
| --- | --- |
| 필수 필드 누락 | "필수 항목을 입력해주세요." |
| 자재 미입력 | "발주 자재를 추가해주세요." |

---

## 10. 개발 체크리스트

### 10.1 필수 구현 사항

- [ ]  발주 목록 조회 및 필터링
- [ ]  발주 상세 조회
- [ ]  발주 등록 (현장/견적 선택 + 자재 편집)
- [ ]  발주 수정
- [ ]  세트 불러오기 기능
- [ ]  임시저장 기능
- [ ]  탭 이탈 경고 모달

### 10.2 비즈니스 로직

- [ ]  발주 번호 자동 생성
- [ ]  드래그 앤 드롭 순서 변경
- [ ]  견적변경 뱃지 자동 표시
- [ ]  출고 상태 자동 갱신
- [ ]  전체화면 모달 토글

---

## 11. 관련 화면

- 견적 관리: 수주 상태 견적 목록 조회
- 출고 관리: 발주 기준 출고 등록
- 현장 통합 현황: 발주 자재 현황 확인

---
